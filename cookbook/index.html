
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.5.4">
    
    
      
        <title>Cookbook - rpclib</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-b1a1975878.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="rpclib" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Guides
                </span>
              
            
            Cookbook
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    rpclib
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../primer/" title="Primer" class="md-nav__link">
      Primer
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Cookbook
      </label>
    
    <a href="./" title="Cookbook" class="md-nav__link md-nav__link--active">
      Cookbook
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-examples" title="Server examples" class="md-nav__link">
    Server examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-server" title="Creating a server" class="md-nav__link">
    Creating a server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-exposing-free-functions" title="Binding (exposing) free functions" class="md-nav__link">
    Binding (exposing) free functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-lambdas" title="Binding lambdas" class="md-nav__link">
    Binding lambdas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-member-functions" title="Binding member functions" class="md-nav__link">
    Binding member functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-1-binding-through-a-lambda-preferred" title="Version 1: Binding through a lambda (preferred)" class="md-nav__link">
    Version 1: Binding through a lambda (preferred)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-2-using-stdbind" title="Version 2: using std::bind" class="md-nav__link">
    Version 2: using std::bind
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-worker-threads" title="Multiple worker threads" class="md-nav__link">
    Multiple worker threads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-using-custom-types" title="Binding using custom types" class="md-nav__link">
    Binding using custom types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responding-with-errors" title="Responding with errors" class="md-nav__link">
    Responding with errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responding-with-arbitrary-objects" title="Responding with arbitrary objects" class="md-nav__link">
    Responding with arbitrary objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disabling-response" title="Disabling response" class="md-nav__link">
    Disabling response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exiting-a-session" title="Exiting a session" class="md-nav__link">
    Exiting a session
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-a-server" title="Stopping a server" class="md-nav__link">
    Stopping a server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-examples" title="Client examples" class="md-nav__link">
    Client examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-client" title="Creating a client" class="md-nav__link">
    Creating a client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calling-functions" title="Calling functions" class="md-nav__link">
    Calling functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-return-values" title="Getting return values" class="md-nav__link">
    Getting return values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calling-functions-asynchronously" title="Calling functions asynchronously" class="md-nav__link">
    Calling functions asynchronously
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querying-the-connection-state" title="Querying the connection state" class="md-nav__link">
    Querying the connection state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applying-a-timeout-to-synchronous-calls" title="Applying a timeout to synchronous calls" class="md-nav__link">
    Applying a timeout to synchronous calls
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where-to-go-from-here" title="Where to go from here" class="md-nav__link">
    Where to go from here
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../compiling/" title="Compiling" class="md-nav__link">
      Compiling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../internals/" title="Internals" class="md-nav__link">
      Internals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spec/" title="Specification" class="md-nav__link">
      Specification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reference/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../versions/" title="Versions" class="md-nav__link">
      Versions
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-examples" title="Server examples" class="md-nav__link">
    Server examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-server" title="Creating a server" class="md-nav__link">
    Creating a server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-exposing-free-functions" title="Binding (exposing) free functions" class="md-nav__link">
    Binding (exposing) free functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-lambdas" title="Binding lambdas" class="md-nav__link">
    Binding lambdas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-member-functions" title="Binding member functions" class="md-nav__link">
    Binding member functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-1-binding-through-a-lambda-preferred" title="Version 1: Binding through a lambda (preferred)" class="md-nav__link">
    Version 1: Binding through a lambda (preferred)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-2-using-stdbind" title="Version 2: using std::bind" class="md-nav__link">
    Version 2: using std::bind
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-worker-threads" title="Multiple worker threads" class="md-nav__link">
    Multiple worker threads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-using-custom-types" title="Binding using custom types" class="md-nav__link">
    Binding using custom types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responding-with-errors" title="Responding with errors" class="md-nav__link">
    Responding with errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responding-with-arbitrary-objects" title="Responding with arbitrary objects" class="md-nav__link">
    Responding with arbitrary objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disabling-response" title="Disabling response" class="md-nav__link">
    Disabling response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exiting-a-session" title="Exiting a session" class="md-nav__link">
    Exiting a session
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-a-server" title="Stopping a server" class="md-nav__link">
    Stopping a server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-examples" title="Client examples" class="md-nav__link">
    Client examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-client" title="Creating a client" class="md-nav__link">
    Creating a client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calling-functions" title="Calling functions" class="md-nav__link">
    Calling functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-return-values" title="Getting return values" class="md-nav__link">
    Getting return values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calling-functions-asynchronously" title="Calling functions asynchronously" class="md-nav__link">
    Calling functions asynchronously
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querying-the-connection-state" title="Querying the connection state" class="md-nav__link">
    Querying the connection state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applying-a-timeout-to-synchronous-calls" title="Applying a timeout to synchronous calls" class="md-nav__link">
    Applying a timeout to synchronous calls
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where-to-go-from-here" title="Where to go from here" class="md-nav__link">
    Where to go from here
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Cookbook</h1>
                
                <p>Welcome to the Cookbook! This is a collection of short examples that allows you to quickly learn
the ins and outs of <code>rpclib</code>. This guide is written in the spirit of "less talk and more code" (it's mostly only the titles, but also look out for the comments, they contain important information).
If you prefer detailed instructions and explanation, you might want to start with the
<a href="../primer/">Primer</a>.</p>
<h3 id="server-examples">Server examples</h3>
<h4 id="creating-a-server">Creating a server</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="binding-exposing-free-functions">Binding (exposing) free functions</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hey, I&#39;m a free function.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo</span><span class="p">);</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call, handlers run on this thread.</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="binding-lambdas">Binding lambdas</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;hl3&quot;</span><span class="p">,</span> <span class="p">[]()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hey, I&#39;m a lambda!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="binding-member-functions">Binding member functions</h4>
<p>Consider this class:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">foo_class</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">quaz</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hey, I&#39;m a member function!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<h5 id="version-1-binding-through-a-lambda-preferred">Version 1: Binding through a lambda (preferred)</h5>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>
    <span class="n">foo_class</span> <span class="n">foo_obj</span><span class="p">;</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;quaz&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">foo_obj</span><span class="p">](){</span> <span class="n">foo_obj</span><span class="p">.</span><span class="n">quaz</span><span class="p">();</span> <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>

    <span class="c1">// NOTE: you have to make sure that the lifetime of foo_obj</span>
    <span class="c1">// exceeds that of the server.</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h5 id="version-2-using-stdbind">Version 2: using <code>std::bind</code></h5>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>
    <span class="n">foo_class</span> <span class="n">foo_obj</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">functor</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo_class</span><span class="o">::</span><span class="n">quaz</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_obj</span><span class="p">)};</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;quaz&quot;</span><span class="p">,</span> <span class="n">functor</span><span class="p">);</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>

    <span class="c1">// NOTE: you have to make sure that the lifetime of foo_obj</span>
    <span class="c1">// exceeds that of the server.</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="multiple-worker-threads">Multiple worker threads</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hey, I&#39;m a free function.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo</span><span class="p">);</span>

    <span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">thread_count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">async_run</span><span class="p">(</span><span class="n">thread_count</span><span class="p">);</span> <span class="c1">// non-blocking call, handlers execute on one of the workers</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">ignore</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="binding-using-custom-types">Binding using custom types</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">custom_type</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>
    <span class="n">MSGPACK_DEFINE_ARRAY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span> <span class="c1">// or MSGPACK_DEFINE_MAP</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;cool_function&quot;</span><span class="p">,</span> <span class="p">[](</span><span class="n">custom_type</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;c = { &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span>
                  <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;}&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="responding-with-errors">Responding with errors</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;rpc/this_handler.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="p">[]()</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">err_obj</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="s">&quot;Errors are arbitrary objects&quot;</span><span class="p">);</span>
        <span class="n">rpc</span><span class="o">::</span><span class="n">this_handler</span><span class="p">().</span><span class="n">respond_error</span><span class="p">(</span><span class="n">err_obj</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="responding-with-arbitrary-objects">Responding with arbitrary objects</h4>
<p>Even though C++ isn't, <code>msgpack-rpc</code> is very lenient on types. Your client might be implemented in
a dynamic language.</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;rpc/this_handler.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;oh&quot;</span><span class="p">,</span> <span class="p">[](</span><span class="kt">bool</span> <span class="n">quirky</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quirky</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">rpc</span><span class="o">::</span><span class="n">this_handler</span><span class="p">().</span><span class="n">respond</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">&quot;I&#39;m not quirky.&quot;</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="disabling-response">Disabling response</h4>
<p>This prevents the server from ever writing a response to a particular call.</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;rpc/this_handler.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;plz_respond&quot;</span><span class="p">,</span> <span class="p">[](</span><span class="kt">bool</span> <span class="n">nice</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nice</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">rpc</span><span class="o">::</span><span class="n">this_handler</span><span class="p">().</span><span class="n">disable_response</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">&quot;ok&quot;</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="exiting-a-session">Exiting a session</h4>
<p>A session represents a client connection on the server. All ongoing writes and reads are completed first.</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;rpc/this_session.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;exit&quot;</span><span class="p">,</span> <span class="p">[]()</span> <span class="p">{</span>
        <span class="n">rpc</span><span class="o">::</span><span class="n">this_session</span><span class="p">().</span><span class="n">post_exit</span><span class="p">();</span> <span class="c1">// post exit to the queue</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><code>post_exit</code> will add exiting the session as a work item to the queue. This means that exiting is
not instantenous. The TCP connection will be closed gracefully.</p>
<h4 id="stopping-a-server">Stopping a server</h4>
<p>To gracefully stop all sessions on the server. All ongoing writes and reads are completed first.</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/server.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;rpc/this_server.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">server</span> <span class="n">srv</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span> <span class="c1">// listen on TCP port 8080</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;stop_server&quot;</span><span class="p">,</span> <span class="p">[]()</span> <span class="p">{</span>
        <span class="n">rpc</span><span class="o">::</span><span class="n">this_server</span><span class="p">().</span><span class="n">stop</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="n">srv</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="c1">// blocking call</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3 id="client-examples">Client examples</h3>
<h4 id="creating-a-client">Creating a client</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">client</span> <span class="n">c</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">);</span>

    <span class="c1">// client initiates async connection upon creation</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// destructor of client disconnects</span>
<span class="p">}</span>
</pre></div>


<h4 id="calling-functions">Calling functions</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">client</span> <span class="n">c</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">);</span>

    <span class="c1">// client initiates async connection upon creation</span>

    <span class="c1">// call blocks until:</span>
    <span class="c1">// - connection is established</span>
    <span class="c1">// - result is read</span>
    <span class="n">c</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="getting-return-values">Getting return values</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">client</span> <span class="n">c</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="n">as</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="calling-functions-asynchronously">Calling functions asynchronously</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">client</span> <span class="n">c</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">a_future</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">async_call</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// non-blocking, returns std::future</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;I can do something here immediately&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a_future</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">as</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">// possibly blocks if the result is not yet available</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="querying-the-connection-state">Querying the connection state</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">client</span> <span class="n">c</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">);</span>
    <span class="n">client</span><span class="o">::</span><span class="n">connection_state</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">get_connection_state</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="applying-a-timeout-to-synchronous-calls">Applying a timeout to synchronous calls</h4>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rpc/client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">rpc</span><span class="o">::</span><span class="n">client</span> <span class="n">c</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// default timeout is 5000 milliseconds</span>
        <span class="k">const</span> <span class="kt">uint64_t</span> <span class="n">short_timeout</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
        <span class="n">client</span><span class="p">.</span><span class="n">set_timeout</span><span class="p">(</span><span class="n">short_timeout</span><span class="p">);</span>
        <span class="n">client</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="n">short_timeout</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">rpc</span><span class="o">::</span><span class="n">timeout</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// will display a message like</span>
        <span class="c1">// rpc::timeout: Timeout of 50ms while calling RPC function &#39;sleep&#39;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3 id="where-to-go-from-here">Where to go from here</h3>
<p>If you want to know even more about <code>rpclib</code>, look behind the abstractions in the <a href="../internals/">Internals</a> chapter which explains the internal workings and design decisions.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../primer/" title="Primer" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Primer
              </span>
            </div>
          </a>
        
        
          <a href="../glossary/" title="Glossary" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Glossary
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 Tamás Szelei
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-0b7df094bf.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>